(()=>{"use strict";var t,n,e;function r(t,n=null,e){e||(e=t=>{});try{chrome.runtime.sendMessage({eventName:t,data:n},e)}catch(t){}}function i(t,n={},e=[]){const r=document.createElement(t);if(n.class&&("string"==typeof n.class?r.classList.add(n.class):r.classList.add(...n.class)),n.html&&(r.innerHTML=n.html||""),n.attributes)for(const[t,e]of Object.entries(n.attributes))r.setAttribute(t,e);if(n.data)for(const[t,e]of Object.entries(n.data))r.setAttribute(`data-${t}`,e);return n.type&&(r.type=n.type),n.title&&(r.title=n.title),n.alt&&(r.alt=n.alt),n.src&&(r.src=n.src),e&&(!Array.isArray(e)&&e instanceof HTMLElement&&(e=[e]),r.append(...e)),r}function o(t){const n=[],e=document.querySelectorAll(t);return e.forEach((t=>n.push(t))),e}(e=t||(t={})).IMAGE="image",e.AUDIO="audio",e.VIDEO="video",function(t){t.TAB_CREATED="tabCreated",t.TAB_REPLACED="tabReplaced",t.TAB_UPDATED="tabUpdated",t.TAB_ACTIVATED="tabActivated",t.SEND_MEDIA="sendMedia",t.GET_TAB_INFO="getTabInfo"}(n||(n={}));const u=(()=>{let t;const n=[];for(let e=0;e<256;e++){t=e;for(let n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;n[e]=t}return n})();function a(t){return function(t){let n=-1;for(let e=0;e<t.length;e++)n=n>>>8^u[255&(n^t.charCodeAt(e))];return~n>>>0}(t.toString()).toString(16).padStart(8,"0")}const c=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:bmp|gif|jpe?g|png|svg|webp))(?:\?([^#]*))?(?:#(.*))?/i,s=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:mkv|flv|ogg|ogv|gifv|avi|mov|wmv|rm|rmvb|mp4|m4p|m4v|mpg|mpeg|3gp|3g2|webm))(?:\?([^#]*))?(?:#(.*))?/i,l=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:mp3|flac|ogg|wma))(?:\?([^#]*))?(?:#(.*))?/i;function f({src:t}){return!(t.includes("https://www.youtube.com")||t.includes("https://www.youtu.be")||t.includes("https://youtube.com")||t.includes("https://youtu.be"))}function d({src:t}){return!!t}function p(t){return t.startsWith("data:image")||c.test(t)}var v=function(t,n,e,r){return new(e||(e=Promise))((function(i,o){function u(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))};function h(t){return null===t?null:t.startsWith("/")?`${window.location.origin}${t}`:t}function m(){return t=this,n=arguments,r=function*(t="",n=null,e=void 0){let r=null;t.length&&(r=yield function(t){return v(this,void 0,void 0,(function*(){if(null===t)return null;let n;if(/^data:(.+);base64,/.test(t))n=function(t){const n=t.match(/^data:(.+);base64,/),e=n?n[1].split("/")[1]:null;return(null==e?void 0:e.startsWith("svg+xml"))?"svg":e}(t);else{const e=function(t){let n=t.split("/").pop();if(!n||!n.includes("."))return null;n=n.split("?")[0];const e=n.split(".").pop();return e?e.toLowerCase().split("?")[0]:null}(t);if(e)n=e;else try{n=yield function(t){return v(this,void 0,void 0,(function*(){try{const n=(yield fetch(t,{method:"HEAD",referrer:window.location.origin})).headers.get("Content-Type");if(n&&n.split("/")[1].startsWith("svg+xml"))return"svg"}catch(t){return"png"}return null}))}(t)}catch(t){n="png"}}return n||"png"}))}(t));let i=null;null!==n&&"string"!=typeof n&&(i=function(t){const n=t.getAttribute("alt");return n?0===n.length?null:n:null}(n));const o={src:t,alt:i,extension:r};return void 0!==e&&(o.poster=e),o},new((e=void 0)||(e=Promise))((function(i,o){function u(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}));var t,n,e,r}function g(t,n){return function(t){let n=[...new Map(t.map((t=>[t.src,t]))).values()];return n=n.filter((({src:t})=>!!t)),n}(t.map((t=>function(t,n){return{tabUuid:"",tabId:-1,itemIndex:"",src:h(t.src)||"",extension:t.extension,type:n,alt:t.alt,selected:!1,poster:t.poster?h(t.poster):null,uuid:t.uuid||a(t.src),properties:{width:0,height:0,duration:0,durationStr:"",quality:"SD"}}}(t,n))))}var y=function(t,n,e,r){return new(e||(e=Promise))((function(i,o){function u(t){try{c(r.next(t))}catch(t){o(t)}}function a(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var n;t.done?i(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))};function w(t){return y(this,void 0,void 0,(function*(){if("img"===t.tagName.toLowerCase())return m(I(t),t);if("a"===t.tagName.toLowerCase()){const n=t.href;if(p(n))return m(n,t)}const n=window.getComputedStyle(t).backgroundImage;if(n){const t=E(n);if(p(t))return m(t)}return m()}))}function b(t){return y(this,void 0,void 0,(function*(){if("video"===t.tagName.toLowerCase()){return m(I(t.querySelector("source")||t),t,function(t){let n=t.getAttribute("poster")||t.getAttribute("data-poster")||"";const e=null==n?void 0:n.indexOf("#");return e>=0&&(n=n.substring(0,e+1)),n}(t))}if("a"===t.tagName.toLowerCase()){const e=t.href;if((n=e).startsWith("data:video")||s.test(n))return m(e,t,null)}var n;return m("",null,null)}))}function A(t){return y(this,void 0,void 0,(function*(){if("audio"===t.tagName.toLowerCase()){return m(I(t.querySelector("source")||t),t)}if("a"===t.tagName.toLowerCase()){const e=t.href;if((n=e).startsWith("data:audio")||l.test(n))return m(e,t)}var n;return m()}))}function E(t){return t.replace(/^url\(["']?/,"").replace(/["']?\)$/,"")}function I(t){let n=t.getAttribute("src")||"";const e=null==n?void 0:n.indexOf("#");return e>=0&&(n=n.substring(0,e+1)),n}function x(t,n){return y(this,void 0,void 0,(function*(){const e=[...o(t)].map(n);return(yield Promise.all(e)).filter(d).filter(f)}))}(()=>{function e(t,e,i,o,u=null){r(n.SEND_MEDIA,{error:u,image:t,audio:e,video:i,tabInfo:o})}function o(n){return r=this,o=void 0,a=function*(){let r=null,o=[],u=[],a=[];try{const n=yield function(){return y(this,void 0,void 0,(function*(){return x("img, a, [style]",w)}))}(),e=yield Promise.all(Array.from(document.styleSheets).filter((t=>t.hasOwnProperty("cssRules"))).map((({cssRules:t})=>Array.from(t))).flat().filter((t=>t.style&&t.style.backgroundImage)).map((t=>E(t.style.backgroundImage))).filter((t=>!!t)).filter((t=>p(t))).map((t=>m(t))));o=g([...n,...e],t.IMAGE),u=g(yield function(){return y(this,void 0,void 0,(function*(){return x("video, a",b)}))}(),t.VIDEO),a=g(yield function(){return y(this,void 0,void 0,(function*(){return x("audio, a",A)}))}(),t.AUDIO)}catch(t){console.log({err:t}),r=Object.assign({},t)}r?e([],[],[],n,r):(o.forEach((t=>{const r=function(t={}){return i("img",t)}();r.addEventListener("load",(()=>{t.properties.width=r.naturalWidth,t.properties.height=r.naturalHeight,r.remove(),e([t],[],[],n)})),r.src=t.src})),u.forEach((t=>{const r=i("video");r.addEventListener("loadedmetadata",(()=>{var i;t.properties.quality=(i=r.videoWidth)>=3840?"4K":i>=2560?"1440p":i>=1920?"1080p":i>=1280?"720p":i>=854?"480p":i>=640?"360p":"SD",r.remove(),e([],[],[t],n)})),r.src=t.src})),a.forEach((t=>{const r=i("audio");r.addEventListener("loadedmetadata",(()=>{const i=function(t){const n=Math.floor(t%60),e=Math.floor(t%3600/60),r=Math.floor(t/3600),i=n<10?`0${n}`:n,o=e<10?`0${e}`:e;return r>0?`${r}:${o}:${i}`:`${o}:${i}`}(r.duration);t.properties.duration=r.duration,t.properties.durationStr=i,r.remove(),e([],[t],[],n)})),r.src=t.src})))},new((u=void 0)||(u=Promise))((function(t,n){function e(t){try{c(a.next(t))}catch(t){n(t)}}function i(t){try{c(a.throw(t))}catch(t){n(t)}}function c(n){var r;n.done?t(n.value):(r=n.value,r instanceof u?r:new u((function(t){t(r)}))).then(e,i)}c((a=a.apply(r,o||[])).next())}));var r,o,u,a}r(n.GET_TAB_INFO,{},(t=>{o(t)}))})()})();
//# sourceMappingURL=send_media.bundle.js.map