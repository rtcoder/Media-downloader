(()=>{"use strict";var t,n,e;function r(t,n=null,e){e||(e=t=>{});try{chrome.runtime.sendMessage({eventName:t,data:n},e)}catch(t){}}function o(t,n={},e=[]){const r=document.createElement(t);if(n.class&&("string"==typeof n.class?r.classList.add(n.class):r.classList.add(...n.class)),n.html&&(r.innerHTML=n.html||""),n.attributes)for(const[t,e]of Object.entries(n.attributes))r.setAttribute(t,e);if(n.data)for(const[t,e]of Object.entries(n.data))r.setAttribute(`data-${t}`,e);return n.type&&(r.type=n.type),n.title&&(r.title=n.title),n.alt&&(r.alt=n.alt),n.src&&(r.src=n.src),e&&(!Array.isArray(e)&&e instanceof HTMLElement&&(e=[e]),r.append(...e)),r}function i(t){const n=[],e=document.querySelectorAll(t);return e.forEach((t=>n.push(t))),e}!function(t){t.TAB_CREATED="tabCreated",t.TAB_REPLACED="tabReplaced",t.TAB_UPDATED="tabUpdated",t.TAB_ACTIVATED="tabActivated",t.SEND_MEDIA="sendMedia",t.GET_TAB_INFO="getTabInfo"}(t||(t={})),(e=n||(n={})).IMAGE="image",e.AUDIO="audio",e.VIDEO="video";const u=(()=>{let t;const n=[];for(let e=0;e<256;e++){t=e;for(let n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;n[e]=t}return n})();function a(t){const n=function(t){let n=-1;for(let e=0;e<t.length;e++)n=n>>>8^u[255&(n^t.charCodeAt(e))];return~n>>>0}(t);return n.toString(16).padStart(8,"0")}const c=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:bmp|gif|jpe?g|png|svg|webp))(?:\?([^#]*))?(?:#(.*))?/i,s=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:mkv|flv|ogg|ogv|gifv|avi|mov|wmv|rm|rmvb|mp4|m4p|m4v|mpg|mpeg|3gp|3g2|webm))(?:\?([^#]*))?(?:#(.*))?/i,l=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:mp3|flac|ogg|wma))(?:\?([^#]*))?(?:#(.*))?/i;function f({src:t}){return!(t.includes("https://www.youtube.com")||t.includes("https://www.youtu.be")||t.includes("https://youtube.com")||t.includes("https://youtu.be"))}function d({src:t}){return!!t}function p(t){return t.startsWith("data:image")||c.test(t)}var v=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))};function h(t){return null===t?null:t.startsWith("/")?`${window.location.origin}${t}`:t}function m(){return t=this,n=arguments,r=function*(t="",n=null,e=void 0){let r=null;t.length&&(r=yield function(t){return v(this,void 0,void 0,(function*(){if(null===t)return null;let n;if(/^data:(.+);base64,/.test(t))n=function(t){const n=t.match(/^data:(.+);base64,/),e=n?n[1].split("/")[1]:null;return(null==e?void 0:e.startsWith("svg+xml"))?"svg":e}(t);else{const e=function(t){let n=t.split("/").pop();if(!n||!n.includes("."))return null;n=n.split("?")[0];const e=n.split(".").pop();return e?e.toLowerCase().split("?")[0]:null}(t);if(e)n=e;else try{n=yield function(t){return v(this,void 0,void 0,(function*(){try{const n=(yield fetch(t,{method:"HEAD",referrer:window.location.origin})).headers.get("Content-Type");if(n&&n.split("/")[1].startsWith("svg+xml"))return"svg"}catch(t){return"png"}return null}))}(t)}catch(t){n="png"}}return n||"png"}))}(t));let o=null;null!==n&&"string"!=typeof n&&(o=function(t){const n=t.getAttribute("alt");return n?0===n.length?null:n:null}(n));const i={src:t,alt:o,type:r};return void 0!==e&&(i.poster=e),i},new((e=void 0)||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}));var t,n,e,r}function g(t){return function(t){let n=[...new Map(t.map((t=>[t.src,t]))).values()];return n=n.filter((({src:t})=>!!t)),n}(t.map(y))}function y(t){const n={src:h(t.src)||"",type:t.type,alt:t.alt,selected:!1,poster:null,uuid:t.uuid||(e=t.src,a(e.toString())),properties:{width:0,height:0,duration:0,durationStr:"",quality:"SD"}};var e;return void 0===t.poster||(n.poster=t.poster?h(t.poster):null),n}var w=function(t,n,e,r){return new(e||(e=Promise))((function(o,i){function u(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var n;t.done?o(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(u,a)}c((r=r.apply(t,n||[])).next())}))};function b(t){return w(this,void 0,void 0,(function*(){if("img"===t.tagName.toLowerCase())return m(L(t),t);if("a"===t.tagName.toLowerCase()){const n=t.href;if(p(n))return m(n,t)}const n=window.getComputedStyle(t).backgroundImage;if(n){const t=T(n);if(p(t))return m(t)}return m()}))}function A(t){return w(this,void 0,void 0,(function*(){if("video"===t.tagName.toLowerCase()){return m(L(t.querySelector("source")||t),t,function(t){let n=t.getAttribute("poster")||t.getAttribute("data-poster")||"";const e=null==n?void 0:n.indexOf("#");return e>=0&&(n=n.substring(0,e+1)),n}(t))}if("a"===t.tagName.toLowerCase()){const e=t.href;if((n=e).startsWith("data:video")||s.test(n))return m(e,t,null)}var n;return m("",null,null)}))}function E(t){return w(this,void 0,void 0,(function*(){if("audio"===t.tagName.toLowerCase()){return m(L(t.querySelector("source")||t),t)}if("a"===t.tagName.toLowerCase()){const e=t.href;if((n=e).startsWith("data:audio")||l.test(n))return m(e,t)}var n;return m()}))}function T(t){return t.replace(/^url\(["']?/,"").replace(/["']?\)$/,"")}function L(t){let n=t.getAttribute("src")||"";const e=null==n?void 0:n.indexOf("#");return e>=0&&(n=n.substring(0,e+1)),n}function C(t,n){return w(this,void 0,void 0,(function*(){const e=[...i(t)].map(n);return(yield Promise.all(e)).filter(d).filter(f)}))}(()=>{function n(n,e,o,i,u=null){r(t.SEND_MEDIA,{error:u,image:n,audio:e,video:o,tabInfo:i})}function e(t){return e=this,r=void 0,u=function*(){let e=null,r=[],i=[],u=[];try{const t=yield function(){return w(this,void 0,void 0,(function*(){return C("img, a, [style]",b)}))}(),n=yield Promise.all(Array.from(document.styleSheets).filter((t=>t.hasOwnProperty("cssRules"))).map((({cssRules:t})=>Array.from(t))).flat().filter((t=>t.style&&t.style.backgroundImage)).map((t=>T(t.style.backgroundImage))).filter((t=>!!t)).filter((t=>p(t))).map((t=>m(t))));r=g([...t,...n]),i=g(yield function(){return w(this,void 0,void 0,(function*(){return C("video, a",A)}))}()),u=g(yield function(){return w(this,void 0,void 0,(function*(){return C("audio, a",E)}))}())}catch(t){console.log({err:t}),e=Object.assign({},t)}e?n([],[],[],t,e):(r.forEach((e=>{const r=function(t={}){return o("img",t)}();r.addEventListener("load",(()=>{e.properties.width=r.naturalWidth,e.properties.height=r.naturalHeight,r.remove(),n([e],[],[],t)})),r.src=e.src})),i.forEach((e=>{const r=o("video");r.addEventListener("loadedmetadata",(()=>{var o;e.properties.quality=(o=r.videoWidth)>=3840?"4K":o>=2560?"1440p":o>=1920?"1080p":o>=1280?"720p":o>=854?"480p":o>=640?"360p":"SD",r.remove(),n([],[],[e],t)})),r.src=e.src})),u.forEach((e=>{const r=o("audio");r.addEventListener("loadedmetadata",(()=>{const o=function(t){const n=Math.floor(t%60),e=Math.floor(t%3600/60),r=Math.floor(t/3600),o=n<10?`0${n}`:n,i=e<10?`0${e}`:e;return r>0?`${r}:${i}:${o}`:`${i}:${o}`}(r.duration);e.properties.duration=r.duration,e.properties.durationStr=o,r.remove(),n([],[e],[],t)})),r.src=e.src})))},new((i=void 0)||(i=Promise))((function(t,n){function o(t){try{c(u.next(t))}catch(t){n(t)}}function a(t){try{c(u.throw(t))}catch(t){n(t)}}function c(n){var e;n.done?t(n.value):(e=n.value,e instanceof i?e:new i((function(t){t(e)}))).then(o,a)}c((u=u.apply(e,r||[])).next())}));var e,r,i,u}r(t.GET_TAB_INFO,{},(t=>{e(t)}))})()})();
//# sourceMappingURL=send_media.bundle.js.map