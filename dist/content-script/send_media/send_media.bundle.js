(()=>{"use strict";var t,e,n;function r(t,e={},n=[]){const r=document.createElement(t);if(e.class&&("string"==typeof e.class?r.classList.add(e.class):r.classList.add(...e.class)),e.html&&(r.innerHTML=e.html||""),e.attributes)for(const[t,n]of Object.entries(e.attributes))r.setAttribute(t,n);if(e.data)for(const[t,n]of Object.entries(e.data))r.setAttribute(`data-${t}`,n);return e.type&&(r.type=e.type),e.title&&(r.title=e.title),e.alt&&(r.alt=e.alt),e.src&&(r.src=e.src),e.href&&(r.href=e.href),n&&(!Array.isArray(n)&&n instanceof HTMLElement&&(n=[n]),r.append(...n)),r}function o(t){const e=[],n=document.querySelectorAll(t);return n.forEach((t=>e.push(t))),n}(n=t||(t={})).IMAGE="image",n.AUDIO="audio",n.VIDEO="video",function(t){t.TAB_CREATED="tabCreated",t.TAB_REPLACED="tabReplaced",t.TAB_UPDATED="tabUpdated",t.TAB_ACTIVATED="tabActivated",t.SEND_MEDIA="sendMedia",t.QUICK_SEND_MEDIA_FOR_DOWNLOAD="quickSendMediaForDownload",t.GET_TAB_INFO="getTabInfo",t.THEME_CHANGED="themeChanged"}(e||(e={}));const i=(()=>{let t;const e=[];for(let n=0;n<256;n++){t=n;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})();function a(t){const e=Math.floor(t%60),n=Math.floor(t%3600/60),r=Math.floor(t/3600),o=e<10?`0${e}`:e,i=n<10?`0${n}`:n;return r>0?`${r}:${i}:${o}`:`${i}:${o}`}function u(t){return function(t){let e=-1;for(let n=0;n<t.length;n++)e=e>>>8^i[255&(e^t.charCodeAt(n))];return~e>>>0}(t.toString()).toString(16).padStart(8,"0")}const s=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:bmp|gif|jpe?g|png|svg|webp))(?:\?([^#]*))?(?:#(.*))?/i,c=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:mkv|flv|ogg|ogv|gifv|avi|mov|wmv|rm|rmvb|mp4|m4p|m4v|mpg|mpeg|3gp|3g2|webm))(?:\?([^#]*))?(?:#(.*))?/i,l=/(?:([^:\/?#]+):)?(?:\/\/([^\/?#]*))?([^?#]*\.(?:mp3|flac|ogg|wma))(?:\?([^#]*))?(?:#(.*))?/i;function d({src:t}){return!(t.includes("https://www.youtube.com")||t.includes("https://www.youtu.be")||t.includes("https://youtube.com")||t.includes("https://youtu.be"))}function f({src:t}){return!!t}function p(t){return t.startsWith("data:image")||s.test(t)}function h(t){return null===t?null:t.startsWith("/")?`${window.location.origin}${t}`:t}function m(t="",e=null){return{src:t,poster:e}}function g(t){if("img"===t.tagName.toLowerCase())return m(b(t));if("a"===t.tagName.toLowerCase()){const e=t.href;if(p(e))return m(e)}const e=window.getComputedStyle(t).backgroundImage;if(e){const t=w(e);if(p(t))return m(t)}return m()}function v(t){if("video"===t.tagName.toLowerCase()){return m(b(t.querySelector("source")||t),function(t){let e=t.getAttribute("poster")||t.getAttribute("data-poster")||"";const n=null==e?void 0:e.indexOf("#");return n>=0&&(e=e.substring(0,n+1)),e}(t))}if("a"===t.tagName.toLowerCase()){const n=t.href;if((e=n).startsWith("data:video")||c.test(e))return m(n,null)}var e;return m("",null)}function y(t){if("audio"===t.tagName.toLowerCase()){return m(b(t.querySelector("source")||t))}if("a"===t.tagName.toLowerCase()){const n=t.href;if((e=n).startsWith("data:audio")||l.test(e))return m(n)}var e;return m()}function w(t){return t.replace(/^url\(["']?/,"").replace(/["']?\)$/,"")}function b(t){let e=t.getAttribute("src")||"";const n=null==e?void 0:e.indexOf("#");return n>=0&&(e=e.substring(0,n+1)),e}function A(t,e){return[...o(t)].map(e).filter(f).filter(d)}var E=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))};var D=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function u(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((r=r.apply(t,e||[])).next())}))};function I(t,e){return D(this,void 0,void 0,(function*(){const n=t.map((t=>function(t,e){return D(this,void 0,void 0,(function*(){const n=h(t.src)||"";let r=null;n.length&&(r=yield function(t){return E(this,void 0,void 0,(function*(){if(null===t)return null;let e;if(/^data:(.+);base64,/.test(t))e=function(t){const e=t.match(/^data:(.+);base64,/),n=e?e[1].split("/")[1]:null;return(null==n?void 0:n.startsWith("svg+xml"))?"svg":n}(t);else{const n=function(t){let e=t.split("/").pop();if(!e||!e.includes("."))return null;e=e.split("?")[0];const n=e.split(".").pop();return n?n.toLowerCase().split("?")[0]:null}(t);if(n)e=n;else try{e=yield function(t){return E(this,void 0,void 0,(function*(){try{const e=(yield fetch(t,{method:"HEAD",referrer:window.location.origin})).headers.get("Content-Type");if(e&&e.split("/")[1].startsWith("svg+xml"))return"svg"}catch(t){return"png"}return null}))}(t)}catch(t){e="png"}}return e||"png"}))}(n));let o="";return n.length&&(o=n,n.includes("?")&&(o=n.split("?")[0])),{display:!0,order:0,tabUuid:"",tabId:-1,itemIndex:"",src:n,extension:r,type:e,selected:!1,poster:t.poster?h(t.poster):null,uuid:t.uuid||u(o),properties:{width:0,height:0,duration:0,durationStr:"",quality:"SD"}}}))}(t,e)));return function(t){let e=[...new Map(t.map((t=>[t.src,t]))).values()];return e=e.filter((({src:t})=>!!t)),e}(yield Promise.all(n))}))}(()=>{function n(t,n,r=null){!function(t,e=null,n){const r=t=>{if(chrome.runtime.lastError)return null;n||(n=t=>{}),n(t)};try{chrome.runtime.sendMessage({eventName:t,data:e},r)}catch(t){}}(e.SEND_MEDIA,{error:r,media:t,jobHash:n})}!function(){var e,o,i,u;e=this,o=void 0,u=function*(){const e=function(t=10){let e="";for(let n=0;n<t;n++)e+="abcdefghijklmnopqrstuvwxyz".charAt(Math.floor(26*Math.random()));return e}();let o=null,i=[],u=[],s=[];try{const e=A("img, a, [style]",g),n=Array.from(document.styleSheets).filter((t=>t.hasOwnProperty("cssRules"))).map((({cssRules:t})=>Array.from(t))).flat().filter((t=>t.style&&t.style.backgroundImage)).map((t=>w(t.style.backgroundImage))).filter((t=>!!t)).filter((t=>p(t))).map((t=>m(t)));i=yield I([...e,...n],t.IMAGE);const r=A("video, a",v);u=yield I(r,t.VIDEO);const o=A("audio, a",y);s=yield I(o,t.AUDIO)}catch(t){console.log({err:t}),o=Object.assign({},t)}o?n([],e,o):(i.forEach(((t,o)=>{const i=function(t={}){return r("img",t)}();i.addEventListener("load",(()=>{t.properties.width=i.naturalWidth,t.properties.height=i.naturalHeight,t.order=o,i.remove(),n([t],e)})),i.src=t.src})),u.forEach(((t,o)=>{const i=r("video");i.addEventListener("loadedmetadata",(()=>{var r;t.properties.quality=(r=i.videoWidth)>=3840?"4K":r>=2560?"1440p":r>=1920?"1080p":r>=1280?"720p":r>=854?"480p":r>=640?"360p":"SD";const u=a(i.duration);t.properties.duration=i.duration,t.properties.durationStr=u,t.order=o,i.remove(),n([t],e)})),i.src=t.src})),s.forEach(((t,o)=>{const i=r("audio");i.addEventListener("loadedmetadata",(()=>{const r=a(i.duration);t.properties.duration=i.duration,t.properties.durationStr=r,t.order=o,i.remove(),n([t],e)})),i.src=t.src})))},new((i=void 0)||(i=Promise))((function(t,n){function r(t){try{s(u.next(t))}catch(t){n(t)}}function a(t){try{s(u.throw(t))}catch(t){n(t)}}function s(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(r,a)}s((u=u.apply(e,o||[])).next())}))}()})()})();
//# sourceMappingURL=send_media.bundle.js.map