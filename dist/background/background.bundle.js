(()=>{"use strict";var e,n,t,o,i,r=function(e,n,t,o){return new(t||(t=Promise))((function(i,r){function a(e){try{d(o.next(e))}catch(e){r(e)}}function c(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,c)}d((o=o.apply(e,n||[])).next())}))};function a(e){const n={url:e};chrome.downloads.download(n)}function c(e,n){chrome.storage.sync.get(e,n)}function d(e,n){n?chrome.storage.sync.set(e,n):chrome.storage.sync.set(e)}function l(e,n=null,t){const o=e=>{if(chrome.runtime.lastError)return null;t||(t=e=>{}),t(e)};try{chrome.runtime.sendMessage({eventName:e,data:n},o)}catch(e){}}function s(e){chrome.contextMenus.create(e)}(i=e||(e={})).IMAGE="image",i.AUDIO="audio",i.VIDEO="video",(o=n||(n={})).LIGHT="light",o.DARK="dark",o.SYSTEM="system",function(e){e.POPUP="popup",e.SIDE_PANEL="side-panel"}(t||(t={}));const u={theme:n.SYSTEM,defaultAction:t.POPUP,previousVersion:null,showChangelogLink:!1,lastOpenSection:e.IMAGE,filters:{},filtersOpen:!1};function h(e){c({defaultAction:t.POPUP},(({defaultAction:n})=>{n||(n=u.defaultAction),e(n)}))}var m,v;function f(){const e="/views/downloader.html";h((n=>{const o=n===t.SIDE_PANEL,i=n===t.POPUP?e:"",r=o?e:"";var a;a={openPanelOnActionClick:o},chrome.sidePanel.setPanelBehavior(a).catch((e=>console.log(e))),function(e){chrome.sidePanel.setOptions(e)}({path:r}),function(e){chrome.action.setPopup(e)}({popup:i})}))}Object.keys(u),function(e){e.TAB_CREATED="tabCreated",e.TAB_REPLACED="tabReplaced",e.TAB_UPDATED="tabUpdated",e.TAB_ACTIVATED="tabActivated",e.SEND_MEDIA="sendMedia",e.QUICK_SEND_MEDIA_FOR_DOWNLOAD="quickSendMediaForDownload",e.GET_TAB_INFO="getTabInfo",e.THEME_CHANGED="themeChanged"}(m||(m={})),v=(e,n,t)=>{f(),l(m.TAB_UPDATED,{tabId:e,changeInfo:n,tab:t})},chrome.tabs.onUpdated.addListener(v),chrome.tabs.onActivated.addListener((e=>{f(),l(m.TAB_ACTIVATED,{tabId:e.tabId})})),chrome.tabs.onReplaced.addListener((e=>{f(),l(m.TAB_REPLACED,{tabId:e})})),chrome.tabs.onCreated.addListener((e=>{f(),l(m.TAB_CREATED,{tab:e})})),chrome.action.onClicked.addListener((e=>{f(),function(e){h((n=>{switch(n){case t.POPUP:chrome.action.openPopup(void 0);break;case t.SIDE_PANEL:o={windowId:e.windowId},chrome.sidePanel.open(o)}var o}))}(e)})),chrome.runtime.onInstalled.addListener((e=>{f(),s({id:"downloadAllMedia",title:"Download all media",contexts:["page"]}),s({id:"quickDownloadImage",title:"Quick download",contexts:["image"]}),function(e){if("update"!==e.reason)return;const n=chrome.runtime.getManifest().version;var t;t=e=>{e!==n&&d({showChangelogLink:!0}),d({previousVersion:n})},c({previousVersion:null},(({previousVersion:e})=>{e||(e=u.previousVersion),t(e)}))}(e)})),chrome.contextMenus.onClicked.addListener(((e,n)=>{n&&((e,n)=>{"downloadAllMedia"!==e.menuItemId?"quickDownloadImage"===e.menuItemId&&e.srcUrl&&a(e.srcUrl):function(e=null){!function(e){r(this,arguments,void 0,(function*(e,n=null){if(!n){const e=yield function(){return r(this,void 0,void 0,(function*(){var e,n;try{let t={active:!0,lastFocusedWindow:!0},[o]=yield chrome.tabs.query(t);return!(null==o?void 0:o.url)||(null===(e=null==o?void 0:o.url)||void 0===e?void 0:e.startsWith("chrome://"))||(null===(n=null==o?void 0:o.url)||void 0===n?void 0:n.startsWith("https://chromewebstore.google.com"))?null:o}catch(e){return null}}))}();if(!e||!e.id)return;if(e.id<=0)return;n=e.id}yield chrome.scripting.executeScript({target:{tabId:n,allFrames:!0},files:[e]})}))}("/dist/content-script/quick_send_media/quick_send_media.bundle.js",e)}(n.id)})(e,n)})),function(e){chrome.runtime.onMessage.addListener(e)}(((e,n,t)=>{var o;if(null===(o=n.tab)||void 0===o?void 0:o.id){if(e.eventName===m.GET_TAB_INFO)return function(e){return r(this,void 0,void 0,(function*(){var n,t;try{const o=yield chrome.tabs.get(e);return chrome.runtime.lastError?(console.error("Error get tab by ID:",chrome.runtime.lastError),null):!(null==o?void 0:o.url)||(null===(n=null==o?void 0:o.url)||void 0===n?void 0:n.startsWith("chrome://"))||(null===(t=null==o?void 0:o.url)||void 0===t?void 0:t.startsWith("https://chromewebstore.google.com"))?null:o}catch(e){return null}}))}(n.tab.id).then(t),!0;if(e.eventName===m.QUICK_SEND_MEDIA_FOR_DOWNLOAD){return e.data.media.forEach((e=>a(e.src))),void t(null)}}else t(null)}))})();
//# sourceMappingURL=background.bundle.js.map