(()=>{"use strict";var t,e;(e=t||(t={})).IMAGE="image",e.AUDIO="audio",e.VIDEO="video";var n,i,o,r,c=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}l((i=i.apply(t,e||[])).next())}))};function s(){return c(this,void 0,void 0,(function*(){var t,e;try{let n={active:!0,lastFocusedWindow:!0},[i]=yield chrome.tabs.query(n);return!(null==i?void 0:i.url)||(null===(t=null==i?void 0:i.url)||void 0===t?void 0:t.startsWith("chrome://"))||(null===(e=null==i?void 0:i.url)||void 0===e?void 0:e.startsWith("https://chromewebstore.google.com"))?null:i}catch(t){return null}}))}function l(t){return c(this,void 0,void 0,(function*(){var e,n;try{const i=yield chrome.tabs.get(t);return chrome.runtime.lastError?(console.error("Error get tab by ID:",chrome.runtime.lastError),null):!(null==i?void 0:i.url)||(null===(e=null==i?void 0:i.url)||void 0===e?void 0:e.startsWith("chrome://"))||(null===(n=null==i?void 0:i.url)||void 0===n?void 0:n.startsWith("https://chromewebstore.google.com"))?null:i}catch(t){return null}}))}function a(t,e){chrome.storage.sync.get(t,e)}function d(t,e){e?chrome.storage.sync.set(t,e):chrome.storage.sync.set(t)}(r=n||(n={})).LIGHT="light",r.DARK="dark",r.SYSTEM="system",(o=i||(i={})).POPUP="popup",o.SIDE_PANEL="side-panel";const u={theme:n.SYSTEM,defaultAction:i.POPUP,previousVersion:null,showChangelogLink:!1,lastOpenSection:t.IMAGE,filters:{},filtersOpen:!1};function h(t,e,n=null){let i=[];i="string"==typeof t?function(t){const e=[],n=document.querySelectorAll(t);return n.forEach((t=>e.push(t))),n}(t):Array.isArray(t)?[...t]:[t],i.length&&(null===n?[...i].forEach((t=>{t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)})):n?[...i].forEach((t=>t.classList.add(e))):[...i].forEach((t=>t.classList.remove(e))))}function f(t,e={},n=[]){const i=document.createElement(t);if(e.class&&("string"==typeof e.class?i.classList.add(e.class):i.classList.add(...e.class)),e.html&&(i.innerHTML=e.html||""),e.attributes)for(const[t,n]of Object.entries(e.attributes))i.setAttribute(t,n);if(e.data)for(const[t,n]of Object.entries(e.data))i.setAttribute(`data-${t}`,n);return e.type&&(i.type=e.type),e.title&&(i.title=e.title),e.alt&&(i.alt=e.alt),e.src&&(i.src=e.src),e.href&&(i.href=e.href),n&&(!Array.isArray(n)&&n instanceof HTMLElement&&(n=[n]),i.append(...n)),i}function p(t={},e=[]){return f("div",t,e)}function m(t={},e=[]){return f("span",t,e)}function v(t={},e=[]){return t.type="button",f("button",t,e)}function g(t={}){return f("img",t)}function y(t,e=24){return m({html:t,class:"x-icon",attributes:{size:e}})}function b(t){const e="string"==typeof t?A(t):t;e&&(e.hidden=!1)}function E(t){const e="string"==typeof t?A(t):t;e&&(e.hidden=!0)}function A(t){return document.querySelector(t)}Object.keys(u);const I=[],x={},T={},w=[],S=(()=>{let t;const e=[];for(let n=0;n<256;n++){t=n;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})();function C(t){return function(t){let e=-1;for(let n=0;n<t.length;n++)e=e>>>8^S[255&(e^t.charCodeAt(n))];return~e>>>0}(t.toString()).toString(16).padStart(8,"0")}function L(){return A(".section-buttons button.selected").getAttribute("data-section")||t.IMAGE}function D(t,e){return t.order-e.order}const O={minWidth:null,maxWidth:null,minHeight:null,maxHeight:null,imageType:[],videoQuality:[],videoType:[],audioType:[]};function k(t){return p({class:"chip"},[m({html:t}),y("close")])}function _(){d({filters:O}),console.log({FILTERS:O}),P()}function M(){return O}function $(e,n){return e===t.IMAGE?function(t){const e=M();return t.map((t=>{var n;t.display=!0;const{width:i,height:o}=t.properties;return e.maxWidth&&i>e.maxWidth&&(t.display=!1),e.minWidth&&i<e.minWidth&&(t.display=!1),e.minHeight&&o<e.minHeight&&(t.display=!1),e.maxHeight&&o>e.maxHeight&&(t.display=!1),(null===(n=e.imageType)||void 0===n?void 0:n.length)&&!e.imageType.includes(t.extension)&&(t.display=!1),t}))}(n):e===t.AUDIO?function(t){const e=M();return t.map((t=>{var n;return t.display=!0,(null===(n=e.audioType)||void 0===n?void 0:n.length)&&!e.audioType.includes(t.extension)&&(t.display=!1),t}))}(n):e===t.VIDEO?function(t){const e=M();return t.map((t=>{var n,i;return t.display=!0,(null===(n=e.videoQuality)||void 0===n?void 0:n.length)&&!e.videoQuality.includes(t.properties.quality)&&(t.display=!1),(null===(i=e.videoType)||void 0===i?void 0:i.length)&&!e.videoType.includes(t.extension)&&(t.display=!1),t}))}(n):n.map((t=>(t.display=!0,t)))}function q(){return p({class:"thumbnail"})}function H(e,n,i,o,r){const c=e.querySelector(".accordion-body")||p({class:"accordion-body"});if(r)c.appendChild(function(t){return t.querySelector(".yt-info")||p({class:"yt-info"},[m({html:"Note: Chrome Web Store does not allow extensions that download videos from YouTube any longer."}),f("a",{href:"https://developer.chrome.com/docs/webstore/troubleshooting/#prohibited-products",html:"Chrome policy"})])}(c)),c.classList.add("restricted");else{c.querySelectorAll(".grid-item").forEach((t=>t.hidden=!0));const e=n.sort(D).map((e=>function(e,n){const i=e.querySelector(`[data-item-idx="${n.itemIndex}"]`);if(i)return i.hidden=!n.display,i;const o=p({class:["grid-item",...n.selected?["checked"]:[]],attributes:{"data-item-idx":n.itemIndex}});o.hidden=!n.display;const r=v({class:"download_image_button"},y("download")),c=f("a",{attributes:{href:n.src,download:""}},r),s=m({class:"item-details-dimensions"}),l=m({class:"item-details-ext",html:n.extension}),a=m({class:"item-details-duration"});let d=null;switch(n.type){case t.IMAGE:s.textContent=`${n.properties.width} x ${n.properties.height}`,d=function(t){const e=q(),n=g({src:t});return e.appendChild(n),e}(n.src);break;case t.AUDIO:a.textContent=n.properties.durationStr,d=function(){const t=q(),e=y("music_note",50);return t.appendChild(e),t}();break;case t.VIDEO:a.textContent=n.properties.durationStr,s.textContent=n.properties.quality,d=function(t){const e=q(),n=y("videocam",50),i=g({src:t});return e.appendChild(t?i:n),e}(n.poster)}return o.appendChild(c),o.appendChild(l),o.appendChild(s),o.appendChild(a),d&&o.appendChild(d),o}(c,e)));c.append(...e)}return c}function U(t,e){e||(e=p({class:"accordion-group",attributes:{"data-tab-subgroup":t}})),function(t){return Object.values(T).filter((e=>e.id===t))}(t).forEach((t=>{const n=e.querySelector(`[tab-uuid="${t.uuid}"]`);e.appendChild(function(t,e){const{title:n,uuid:i,id:o,favIconUrl:r,isRestricted:c}=t,s=$(L(),W(i)),l=R(i),a=e||p({class:["accordion-item",...l?["active"]:[]]});a.setAttribute("tab-uuid",i),a.classList.remove("first-item");const d=function(t,e,n,i){const o=i.length,r=i.filter((t=>t.display)).length,c=r===o?`(${r})`:`(${r} / ${o})`;t.hidden=0===r;const s=t.querySelector(".accordion-header");return s?(s.querySelector(".tab-media-count").innerHTML=c,s):p({class:"accordion-header"},v({class:"accordion-button"},[g({src:e,class:"favicon",alt:"Favicon"}),m({class:"tab-title"},[m({class:"title",html:n}),m({class:"tab-media-count",html:c})]),m({class:"tab-toggle"})]))}(a,r,n,s),u=H(a,s,0,0,c);return a.appendChild(d),a.appendChild(u),a}(t,n))}));const n=Array.from(e.querySelectorAll(".accordion-item")).find((t=>!t.hasAttribute("hidden")));return n&&n.classList.add("first-item"),e}function W(t){const e=L();let n=I.filter((t=>t.type===e));return t&&(n=n.filter((e=>e.tabUuid===t))),n}function P(){!function(){const t=A(".accordion");w.forEach((e=>{const n=t.querySelector(`[data-tab-subgroup="${e}"]`);t.appendChild(U(e,n))}))}();const t=L();A(".count-all").innerHTML=I.filter((e=>e.display&&e.type===t)).length.toString()}function G(t,e){x[t]=e}function R(t){return x[t]}const j=[t.IMAGE,t.AUDIO,t.VIDEO];function B(t){const{checked:e}=t.target;let n=!0,i=!0;const o=$(L(),W());let r=0;h(".grid-item","checked",e);for(let t=0;t<o.length;t++)o[t].selected=e,o[t].selected?(i=!1,r++):n=!1;N(r);const c=A("#toggle_all_checkbox");c.indeterminate=!(n||i),n?c.checked=!0:i&&(c.checked=!1)}function N(t){var e;A("#download-btn .selected-count").innerHTML=t>0?`(${t})`:"",e=!t,A("#download-btn").disabled=e}function V(e){d({lastOpenSection:e=j.includes(e)?e:t.IMAGE}),h(".section-buttons button","selected",!1),h(`.section-buttons button[data-section="${e}"]`,"selected",!0);const n=A(".filters");n.classList.remove(t.IMAGE,t.AUDIO,t.VIDEO),n.classList.add(e)}function F(t=null){!function(t){c(this,arguments,void 0,(function*(t,e=null){if(!e){const t=yield s();if(!t||!t.id)return;if(t.id<=0)return;e=t.id}yield chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},files:[t]})}))}("/dist/content-script/send_media/send_media.bundle.js",t)}var Q;!function(t){t.TAB_CREATED="tabCreated",t.TAB_REPLACED="tabReplaced",t.TAB_UPDATED="tabUpdated",t.TAB_ACTIVATED="tabActivated",t.SEND_MEDIA="sendMedia",t.QUICK_SEND_MEDIA_FOR_DOWNLOAD="quickSendMediaForDownload",t.GET_TAB_INFO="getTabInfo",t.THEME_CHANGED="themeChanged"}(Q||(Q={}));const Y=["https://youtube.com","https://www.youtube.com"];function K(t){return Y.some((e=>t.includes(e)))}function z(t){const e=t.id,n=C(`${e}-${t.url}`);T[n]={id:e,favIconUrl:t.favIconUrl,url:t.url,title:t.title,isRestricted:K(t.url),uuid:n},w.includes(e)||w.push(e)}const J={};function X(t){return e=this,n=void 0,o=function*(){if(t.error&&Object.keys(t.error).length>0)return void console.log(t);const e=J[t.jobHash]||(yield s());if(!e)return;J[t.jobHash]=e,z(e);const n=C(`${e.id}-${e.url}`);K(e.url)||(t.media.map((t=>(t.tabId=e.id,t.tabUuid=n,t.itemIndex=`${e.id}-${n}-${t.uuid}`,t))).forEach((t=>{I.find((e=>e.itemIndex===t.itemIndex))||I.push(t)})),j.forEach((t=>{const e=I.filter((e=>e.type===t)).length;A(`.section-buttons button[data-section="${t}"] .items-count`).innerHTML=e.toString()}))),P()},new((i=void 0)||(i=Promise))((function(t,r){function c(t){try{l(o.next(t))}catch(t){r(t)}}function s(t){try{l(o.throw(t))}catch(t){r(t)}}function l(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(c,s)}l((o=o.apply(e,n||[])).next())}));var e,n,i,o}var Z,tt=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function c(t){try{l(i.next(t))}catch(t){r(t)}}function s(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(c,s)}l((i=i.apply(t,e||[])).next())}))};F(),function(){var t;t=(t,e,n)=>{const{eventName:i,data:o}=t;switch(i){case Q.TAB_UPDATED:o.tabId,r=o.changeInfo,z(c=o.tab),c.active&&"complete"===r.status&&F(c.id);break;case Q.TAB_ACTIVATED:!function(t){tt(this,void 0,void 0,(function*(){const e=yield l(t);e&&(z(e),e.active&&F(t))}))}(o.tabId);break;case Q.TAB_CREATED:!function(t){z(t),t.active&&F(t.id)}(o.tab);break;case Q.TAB_REPLACED:!function(t){tt(this,void 0,void 0,(function*(){const e=yield l(t);e&&(z(e),e.active&&F(t))}))}(o.tabId);break;case Q.SEND_MEDIA:X(o)}var r,c;n(null)},chrome.runtime.onMessage.addListener(t)}(),document.body.addEventListener("click",(t=>{const{target:e}=t;if(e)if(e.closest("#download-btn"))W().filter((t=>t.selected)).forEach((t=>function(t){const e={url:t};chrome.downloads.download(e)}(t.src)));else{if(e.closest(".section-buttons button"))return V(e.closest(".section-buttons button").getAttribute("data-section")),void P();if(e.matches(".thumbnail"))!function(t){const e=t.closest(".grid-item"),n=e.getAttribute("data-item-idx"),i=!e.classList.contains("checked");h(e,"checked");const o=I.findIndex((t=>t.itemIndex===n));if(-1===o)return;I[o].selected=i;let r=!0,c=!0;const s=W();let l=0;for(let t=0;t<s.length;t++)s[t].selected?(c=!1,l++):r=!1;N(l);const a=A("#toggle_all_checkbox");a.indeterminate=!(r||c),r?a.checked=!0:c&&(a.checked=!1)}(e);else if(e.matches(".yt-info a"))window.open("https://developer.chrome.com/docs/webstore/troubleshooting/#prohibited-products");else{if(e.matches(".changelog-link"))return d({showChangelogLink:!1}),n={url:"views/changelog/index.html"},chrome.tabs.create(n),void E(e);var n;if(e.closest(".accordion-header")){const t=e.closest(".accordion-header"),n=t.closest(".accordion-item").getAttribute("tab-uuid");R(n)?(G(n,!1),h(t.closest(".accordion-item"),"active",!1)):(G(n,!0),h(t.closest(".accordion-item"),"active",!0))}}}})),A("#toggle_all_checkbox").addEventListener("change",B),function(){var t;!function(){const t=A(".filters");t.addEventListener("change",(t=>{const e=t.target;if(e.matches("select")){if(!e.value)return;if(O[e.id].includes(e.value))return void(e.value="");const t=k(e.value);return e.closest(".label-group").querySelector(".chips").appendChild(t),O[e.id].push(e.value),_(),void(e.value="")}})),t.addEventListener("input",(t=>{const e=t.target;if(e.matches("input"))return e.value?O[e.id]=e.value:O[e.id]=null,void _()})),t.addEventListener("click",(t=>{const e=t.target;if(e.matches(".filters .x-icon.open-filters"))return b(".filters .filters-content"),void d({filtersOpen:!0});if(e.matches(".filters .close-filters"))return E(".filters .filters-content"),void d({filtersOpen:!1});if(e.matches(".chip .x-icon")){const t=e.parentElement.querySelector("span").textContent,n=e.closest(".label-group").querySelector("select").id,i=O[n].indexOf(t);return O[n].splice(i,1),e.parentElement.remove(),void _()}}))}(),t=t=>{Object.keys(t).forEach((e=>{O[e]=t[e]})),["minWidth","maxWidth","minHeight","maxHeight"].forEach((t=>{const e=A(`input#${t}`),n=O[t];n&&(e.value=n)})),["imageType","videoQuality","videoType","audioType"].forEach((t=>{const e=A(`select#${t}`),n=O[t],i=e.closest(".label-group").querySelector(".chips");n.forEach((t=>{const e=k(t);i.appendChild(e)}))}))},a({filters:{}},(({filters:e})=>{e||(e=u.filters),t(e)})),a({filtersOpen:!1},(({filtersOpen:t})=>{(t=>{t?b(".filters .filters-content"):E(".filters .filters-content")})(!!t)}))}(),Z=t=>{t&&b(".changelog-link")},a({showChangelogLink:!1},(({showChangelogLink:t})=>{Z(!!t)})),a({lastOpenSection:t.IMAGE},(({lastOpenSection:t})=>{t||(t=u.lastOpenSection),(t=>{V(t)})(t)}))})();
//# sourceMappingURL=main.bundle.js.map