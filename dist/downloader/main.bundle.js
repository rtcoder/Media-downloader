(()=>{"use strict";var t;!function(t){t.IMAGE="image",t.AUDIO="audio",t.VIDEO="video"}(t||(t={}));var e,n,i,o,c=function(t,e,n,i){return new(n||(n=Promise))((function(o,c){function r(t){try{a(i.next(t))}catch(t){c(t)}}function s(t){try{a(i.throw(t))}catch(t){c(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}a((i=i.apply(t,e||[])).next())}))};function r(){return c(this,void 0,void 0,(function*(){var t,e;try{let n={active:!0,lastFocusedWindow:!0},[i]=yield chrome.tabs.query(n);return!(null==i?void 0:i.url)||(null===(t=null==i?void 0:i.url)||void 0===t?void 0:t.startsWith("chrome://"))||(null===(e=null==i?void 0:i.url)||void 0===e?void 0:e.startsWith("https://chromewebstore.google.com"))?null:i}catch(t){return null}}))}function s(t){return c(this,void 0,void 0,(function*(){var e,n;try{const i=yield chrome.tabs.get(t);return chrome.runtime.lastError?(console.error("Error get tab by ID:",chrome.runtime.lastError),null):!(null==i?void 0:i.url)||(null===(e=null==i?void 0:i.url)||void 0===e?void 0:e.startsWith("chrome://"))||(null===(n=null==i?void 0:i.url)||void 0===n?void 0:n.startsWith("https://chromewebstore.google.com"))?null:i}catch(t){return null}}))}function a(t,e){chrome.storage.sync.get(t,e)}function l(t,e){e?chrome.storage.sync.set(t,e):chrome.storage.sync.set(t)}(o=e||(e={})).LIGHT="light",o.DARK="dark",o.SYSTEM="system",(i=n||(n={})).POPUP="popup",i.SIDE_PANEL="side-panel";const u={theme:e.SYSTEM,defaultAction:n.POPUP,previousVersion:null,showChangelogLink:!1,lastOpenSection:t.IMAGE,filters:{},filtersOpen:!1};function d(t,e,n=null){let i=[];i="string"==typeof t?function(t){const e=[],n=document.querySelectorAll(t);return n.forEach((t=>e.push(t))),n}(t):Array.isArray(t)?[...t]:[t],i.length&&(null===n?[...i].forEach((t=>{t.classList.contains(e)?t.classList.remove(e):t.classList.add(e)})):n?[...i].forEach((t=>t.classList.add(e))):[...i].forEach((t=>t.classList.remove(e))))}function f(t,e={},n=[]){const i=document.createElement(t);if(e.class&&("string"==typeof e.class?i.classList.add(e.class):i.classList.add(...e.class)),e.html&&(i.innerHTML=e.html||""),e.attributes)for(const[t,n]of Object.entries(e.attributes))i.setAttribute(t,n);if(e.data)for(const[t,n]of Object.entries(e.data))i.setAttribute(`data-${t}`,n);return e.type&&(i.type=e.type),e.title&&(i.title=e.title),e.alt&&(i.alt=e.alt),e.src&&(i.src=e.src),n&&(!Array.isArray(n)&&n instanceof HTMLElement&&(n=[n]),i.append(...n)),i}function h(t={},e=[]){return f("div",t,e)}function p(t={},e=[]){return f("span",t,e)}function m(t={},e=[]){return t.type="button",f("button",t,e)}function v(t={}){return f("img",t)}function g(t,e=24){return p({html:t,class:"x-icon",attributes:{size:e}})}function b(t){const e="string"==typeof t?E(t):t;e&&(e.hidden=!1)}function y(t){const e="string"==typeof t?E(t):t;e&&(e.hidden=!0)}function E(t){return document.querySelector(t)}Object.keys(u);const A=[],I={},T={};function w(){return h({class:"thumbnail"})}function x(e,n,i,o){const c=h({class:"accordion-body"});return o?(c.appendChild(h({class:"yt-info"},[p({html:"Note: Chrome Web Store does not allow extensions that download videos from YouTube any longer."}),f("a",{href:"https://developer.chrome.com/docs/webstore/troubleshooting/#prohibited-products",html:"Chrome policy"})])),c.classList.add("restricted")):c.append(...e.map((e=>function(e,n){const{src:i,alt:o,poster:c,type:r,selected:s,filetype:a}=e,l=h({class:["grid-item",...s?["checked"]:[]],attributes:{"data-src-dw":i,"data-filename":(null==o?void 0:o.length)?o:"","data-item-idx":n,"data-type":r}}),u=m({class:"download_image_button"},g("download")),d=f("a",{attributes:{href:e.src,download:e.alt||""}},u),b=p({class:"item-details-dimensions"}),y=p({class:"item-details"},[p({class:"item-details-ext",html:a}),b]);let E=null;switch(r){case t.IMAGE:b.textContent=`${e.properties.width} x ${e.properties.height}`,E=function(t){const e=w(),n=v({src:t});return e.appendChild(n),e}(i);break;case t.AUDIO:b.textContent=e.properties.durationStr,E=function(){const t=w(),e=g("music_note",50);return t.appendChild(e),t}();break;case t.VIDEO:b.textContent=e.properties.quality,E=function(t){const e=w(),n=g("videocam",50),i=v({src:t});return e.appendChild(t?i:n),e}(c)}return l.appendChild(d),l.appendChild(y),E&&l.appendChild(E),l}(e,`${n}-${i}-${e.uuid}`)))),c}function L(t){const e=E(".accordion");e.innerHTML="",t.forEach((t=>{e.appendChild(function(t){const e=h({class:"accordion-group",attributes:{"data-tab-subgroup":t.tabId}});return t.data.forEach((t=>{e.appendChild(function(t){const{title:e,uuid:n,id:i,favIconUrl:o,isRestricted:c}=T[t.tabUuid],r=h({class:["accordion-item",...I[n]?["active"]:[]]});r.setAttribute("tab-uuid",n);const s=(a=o,l=e,u=t.items.length,h({class:"accordion-header"},m({class:"accordion-button"},[v({src:a,class:"favicon",alt:"Favicon"}),p({class:"tab-title"},[p({class:"title",html:l}),p({class:"tab-media-count",html:`(${u})`})]),p({class:"tab-toggle"})])));var a,l,u;const d=x(t.items,i,n,c);return r.appendChild(s),r.appendChild(d),r}(t))})),e}(t))}))}const O={minWidth:null,maxWidth:null,minHeight:null,maxHeight:null,imageType:[],videoQuality:[],videoType:[],audioType:[]};function k(t){return h({class:"chip"},[p({html:t}),g("close")])}function C(){l({filters:O}),console.log({FILTERS:O}),q()}function D(){return O}function S(t,e){return t.map((t=>(t.data=t.data.map((t=>(t.items=e(t.items),t))),t)))}function M(t){const e=D();return t.filter((t=>{var n;const{width:i,height:o}=t.properties;return!(e.maxWidth&&i>e.maxWidth||e.minWidth&&i<e.minWidth||e.minHeight&&o<e.minHeight||e.maxHeight&&o>e.maxHeight||(null===(n=e.imageType)||void 0===n?void 0:n.length)&&!e.imageType.includes(t.filetype))}))}function _(t){const e=D();return t.filter((t=>{var n,i;return!((null===(n=e.videoQuality)||void 0===n?void 0:n.length)&&!e.videoQuality.includes(t.properties.quality)||(null===(i=e.audioType)||void 0===i?void 0:i.length)&&!e.audioType.includes(t.type))}))}function U(t){const e=D();return t.filter((t=>{var n,i;return!((null===(n=e.videoQuality)||void 0===n?void 0:n.length)&&!e.videoQuality.includes(t.properties.quality)||(null===(i=e.videoType)||void 0===i?void 0:i.length)&&!e.videoType.includes(t.type))}))}const $=(()=>{let t;const e=[];for(let n=0;n<256;n++){t=n;for(let e=0;e<8;e++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e})();function H(t){return t.reduce(((t,e)=>t+e.data.reduce(((t,e)=>t+e.items.length),0)),0)}function W(t){return function(t){let e=-1;for(let n=0;n<t.length;n++)e=e>>>8^$[255&(e^t.charCodeAt(n))];return~e>>>0}(t.toString()).toString(16).padStart(8,"0")}function P(){return E(".section-buttons button.selected").getAttribute("data-section")||t.IMAGE}function G(){const t=P();return A.map((e=>{const n=e.elements.map((({media:e,tabUuid:n})=>{const i=(e=>e[t].map((e=>function(t,e){const{properties:n,src:i,uuid:o,poster:c,type:r,selected:s,alt:a}=t;return{properties:n,src:i,uuid:o,poster:c,filetype:r,selected:s,type:e,alt:a}}(e,t))))(e);return{tabUuid:n,items:i}}));return{tabId:e.tabId,data:n}}))}function q(){const e=G(),n=H(e).toString();let i,o=n;const c=P();(function(e){const n={[t.IMAGE]:["minWidth","maxWidth","minHeight","maxHeight","imageType"],[t.VIDEO]:["videoType","videoQuality"],[t.AUDIO]:["audioType"]};return Object.keys(O).filter((t=>n[e].includes(t))).some((t=>{var e;return!!(null===(e=O[t])||void 0===e?void 0:e.length)}))})(c)&&(i=function(e,n){return e===t.IMAGE?S(n,M):e===t.AUDIO?S(n,_):e===t.VIDEO?S(n,U):n}(c,e),o=H(i).toString());const r=n===o?n:`${o} / ${n}`;L(e),E(".count-all").innerHTML=r}function B(t,e){I[t]=e}function R(t){!function(t,e=null){const n={url:t};e&&(n.filename=e),chrome.downloads.download(n)}(t.url,t.alt)}const V=[t.IMAGE,t.AUDIO,t.VIDEO];function j(t){const{checked:e}=t.target;let n=!0,i=!0;const o=G();let c=0;d(".grid-item","checked",e);for(let t=0;t<o.length;t++){const{data:r}=o[t];for(let t=0;t<r.length;t++){const{items:o}=r[t];for(let t=0;t<o.length;t++)o[t].selected=e,o[t].selected?(i=!1,c++):n=!1}}Q(c);const r=E("#toggle_all_checkbox");r.indeterminate=!(n||i),n?r.checked=!0:i&&(r.checked=!1)}function Q(t){var e;E("#download-btn .selected-count").innerHTML=t>0?`(${t})`:"",e=!t,E("#download-btn").disabled=e}function N(e){l({lastOpenSection:e=V.includes(e)?e:t.IMAGE}),d(".section-buttons button","selected",!1),d(`.section-buttons button[data-section="${e}"]`,"selected",!0);const n=E(".filters");n.classList.remove(t.IMAGE,t.AUDIO,t.VIDEO),n.classList.add(e)}function F(t=null){!function(t){c(this,arguments,void 0,(function*(t,e=null){if(!e){const t=yield r();if(!t||!t.id)return;if(t.id<=0)return;e=t.id}yield chrome.scripting.executeScript({target:{tabId:e,allFrames:!0},files:[t]})}))}("/dist/content-script/send_media.bundle.js",t)}var Y;!function(t){t.TAB_CREATED="tabCreated",t.TAB_REPLACED="tabReplaced",t.TAB_UPDATED="tabUpdated",t.TAB_ACTIVATED="tabActivated",t.SEND_MEDIA="sendMedia",t.GET_TAB_INFO="getTabInfo"}(Y||(Y={}));const z=["https://youtube.com","https://www.youtube.com"];function K(t){return z.some((e=>t.includes(e)))}function J(t){return e=this,n=void 0,o=function*(){if(t.error&&Object.keys(t.error).length>0)return void console.log(t);const e=t.tabInfo||(yield r());if(!e)return;const n={image:[],video:[],audio:[]};!function(t){const e=W(`${t.id}-${t.url}`);T[e]={id:t.id,favIconUrl:t.favIconUrl,url:t.url,title:t.title,isRestricted:K(t.url),uuid:e}}(e);const i=W(`${e.id}-${e.url}`),o=K(e.url);let c=function(t){let e=A.findIndex((({tabId:t})=>t==t));return-1===e&&(A.push({tabId:t,elements:[]}),e=A.length-1),e}(e.id);const s=function(t,e){let n=A[e].elements.findIndex((e=>e.tabUuid===t));return-1===n&&(A[e].elements.push({media:{image:[],video:[],audio:[]},tabUuid:t}),n=A[e].elements.length-1),n}(i,c),{media:a}=A[c].elements[s];if(o)return void q();const l={image:t.image,audio:t.audio,video:t.video};V.filter((t=>!!l[t])).forEach((t=>{var e;l[t].forEach((e=>n[t].push(e))),A[c].elements[s].media[t]=(e=[...a[t],...n[t]],[...new Map(e.map((t=>[t.src,t]))).values()])})),function(){let t={image:0,audio:0,video:0};A.forEach((e=>{e.elements.forEach((e=>{B(e.tabUuid,!1),V.forEach((n=>{t[n]+=e.media[n].length}))}))})),V.forEach((e=>{E(`.section-buttons button[data-section="${e}"] .items-count`).innerHTML=t[e].toString()}))}(),B(i,!0),q()},new((i=void 0)||(i=Promise))((function(t,c){function r(t){try{a(o.next(t))}catch(t){c(t)}}function s(t){try{a(o.throw(t))}catch(t){c(t)}}function a(e){var n;e.done?t(e.value):(n=e.value,n instanceof i?n:new i((function(t){t(n)}))).then(r,s)}a((o=o.apply(e,n||[])).next())}));var e,n,i,o}var X,Z=function(t,e,n,i){return new(n||(n=Promise))((function(o,c){function r(t){try{a(i.next(t))}catch(t){c(t)}}function s(t){try{a(i.throw(t))}catch(t){c(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}a((i=i.apply(t,e||[])).next())}))};F(),function(){var t;t=t=>{const{eventName:e,data:n}=t;switch(e){case Y.TAB_UPDATED:n.tabId,i=n.changeInfo,(o=n.tab).active&&"complete"===i.status&&F(o.id);break;case Y.TAB_ACTIVATED:!function(t){Z(this,void 0,void 0,(function*(){const e=yield s(t);e&&e.active&&F(t)}))}(n.tabId);break;case Y.TAB_CREATED:!function(t){t.active&&F(t.id)}(n.tab);break;case Y.TAB_REPLACED:!function(t){Z(this,void 0,void 0,(function*(){const e=yield s(t);e&&e.active&&F(t)}))}(n.tabId);break;case Y.SEND_MEDIA:J(n)}var i,o},chrome.runtime.onMessage.addListener(t)}(),document.body.addEventListener("click",(t=>{const{target:e}=t;if(e)if(e.closest("#download-btn"))!function(t){const e=[];for(let n=0;n<t.length;n++){const{data:i}=t[n];for(let t=0;t<i.length;t++){const{items:n}=i[t];for(let t=0;t<n.length;t++)n[t].selected&&e.push({url:n[t].src,alt:n[t].alt})}}e.forEach(R)}(G());else{if(e.closest(".section-buttons button"))return N(e.closest(".section-buttons button").getAttribute("data-section")),void q();if(e.matches(".thumbnail"))!function(t){const e=t.closest(".grid-item"),n=e.getAttribute("data-item-idx"),i=e.getAttribute("data-type"),o=!e.classList.contains("checked");d(e,"checked");const[c,r,s]=n.split("-"),a=A.findIndex((({tabId:t})=>t===+c)),l=A[a].elements.findIndex((t=>t.tabUuid===r));if(-1===l)return;A[a].elements[l].media[i][+s].selected=o;let u=!0,f=!0;const h=G();let p=0;for(let t=0;t<h.length;t++){const{data:e}=h[t];for(let t=0;t<e.length;t++){const{items:n}=e[t];for(let t=0;t<n.length;t++)n[t].selected?(f=!1,p++):u=!1}}Q(p);const m=E("#toggle_all_checkbox");m.indeterminate=!(u||f),u?m.checked=!0:f&&(m.checked=!1)}(e);else if(e.matches(".yt-info a"))window.open("https://developer.chrome.com/docs/webstore/troubleshooting/#prohibited-products");else{if(e.matches(".changelog-link"))return l({showChangelogLink:!1}),n={url:"views/changelog.html"},chrome.tabs.create(n),void y(e);var n;e.closest(".accordion-header")&&d(e.closest(".accordion-header").closest(".accordion-item"),"active")}}})),E("#toggle_all_checkbox").addEventListener("change",j),function(){var t;!function(){const t=E(".filters");t.addEventListener("change",(t=>{const e=t.target;if(e.matches("select")){if(!e.value)return;if(O[e.id].includes(e.value))return void(e.value="");const t=k(e.value);return e.closest(".label-group").querySelector(".chips").appendChild(t),O[e.id].push(e.value),C(),void(e.value="")}})),t.addEventListener("input",(t=>{const e=t.target;if(e.matches("input"))return e.value?O[e.id]=e.value:O[e.id]=null,void C()})),t.addEventListener("click",(t=>{const e=t.target;if(e.matches(".filters .x-icon.open-filters"))return b(".filters .filters-content"),void l({filtersOpen:!0});if(e.matches(".filters .close-filters"))return y(".filters .filters-content"),void l({filtersOpen:!1});if(e.matches(".chip .x-icon")){const t=e.parentElement.querySelector("span").textContent,n=e.closest(".label-group").querySelector("select").id,i=O[n].indexOf(t);return O[n].splice(i,1),e.parentElement.remove(),void C()}}))}(),t=t=>{Object.keys(t).forEach((e=>{O[e]=t[e]})),["minWidth","maxWidth","minHeight","maxHeight"].forEach((t=>{const e=E(`input#${t}`),n=O[t];n&&(e.value=n)})),["imageType","videoQuality","videoType","audioType"].forEach((t=>{const e=E(`select#${t}`),n=O[t],i=e.closest(".label-group").querySelector(".chips");n.forEach((t=>{const e=k(t);i.appendChild(e)}))}))},a({filters:{}},(({filters:e})=>{e||(e=u.filters),t(e)})),a({filtersOpen:!1},(({filtersOpen:t})=>{(t=>{t?b(".filters .filters-content"):y(".filters .filters-content")})(!!t)}))}(),X=t=>{t&&b(".changelog-link")},a({showChangelogLink:!1},(({showChangelogLink:t})=>{X(!!t)})),a({lastOpenSection:t.IMAGE},(({lastOpenSection:t})=>{t||(t=u.lastOpenSection),(t=>{N(t)})(t)}))})();
//# sourceMappingURL=main.bundle.js.map